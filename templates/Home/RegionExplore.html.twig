{% extends 'explore.html.twig' %}


{% block title %}Orbi | {{region.getNombre()}}{% endblock %}

{% block stylesheets %}
{{parent()}}

{% endblock %}



{% block body %}
<main>
 <div id="infoHoteles" data-hotels="{{alojamientos|serialize('json', { groups: 'hotel'})}}" style="display:none"></div>
 <section class="d-flex justify-content-center fixed-top items-center py-16 bg-gray-100" style="top:80px">

    <label class="rad-label">
      <input type="radio"  id="all" class="rad-input" name="rad" checked>
      <div class="rad-design"></div>
      <div class="rad-text">Todos</div>
    </label>
  
    <label class="rad-label">
      <input type="radio" id="Hotel" class="rad-input" name="rad">
      <div class="rad-design"></div>
      <div class="rad-text">Hotel</div>
    </label>

    <label class="rad-label">
      <input type="radio"  id="Hostal" class="rad-input" name="rad">
      <div class="rad-design"></div>
      <div class="rad-text">Hostal</div>
    </label>

    <label class="rad-label">
      <input type="radio" id="Albergue" class="rad-input" name="rad">
      <div class="rad-design"></div>
      <div class="rad-text">Albergue</div>
    </label>
  
    <label class="rad-label">
      <input type="radio" id="CasaRural" class="rad-input" name="rad">
      <div class="rad-design"></div>
      <div class="rad-text">Casa Rural</div>
    </label>
  
   
  </section>


 <div class="container-fluid mt-5" >
    <div class="row pt-3">
        <div class="col-lg-6 py-4 p-xl-5" id="alojamiento">
          <h2 class="mb-4">{{region.getNombre()}}</h2>
          <p>{{region.getDescripcion()}}</p>
          <hr class="my-4">
          <div class="d-flex justify-content-between align-items-center flex-column flex-md-row mb-4">
            <div class="me-3">
              <p class="mb-3 mb-md-0"><strong id="result"></strong> resultados encontrados</p>
            </div>
          </div>
          <div class="row p-2" id="hijo">
          <div class="col-sm-6">
            <div class="packege__item">
                <div class="packege__inner">

                    <div class="packege__thumb">
                        <a href="tour-single.html"><img
                                src="https://template.labartisan.net/demos/explore/assets/images/packege/03.jpg"
                                alt="Travel Thumb"></a>
                        <div class="cart-right">
                            <button tabindex="0" class="addcart-box" title="Quick shop"><i
                                    class="ti-shopping-cart"></i></button>

                        </div>
                    </div>

                    <div class="packege__content">
                        <a href="tour-single.html">
                            <h5 style="color:#222">Enjoy the Beauty place in Bhutan City</h5>
                        </a>
                        <div class="packege__rivew">
                            <div class="left">
                                <span class="rating">Si crees que estÃ¡s en peligro, tienes acceso
                                    prioritario a un equipo especializado que te atenderÃ¡ sea la hora que
                                    sea</span>
                            </div>
                            <div class="right">
                                <span class="packege__price">746 â‚¬ por noche</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
           
          </div>

          
        </div>
   
<div class="col-lg-6 map-side-lg pe-lg-0 " style="z-index: 0;">
      <div class="sticky-top" style="top: 80px">
          <div class="map"  id="map2" ></div>
        </div>
        </div>
      
        
      </div>
    </div>

  </main>

   <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC0tNJpXxOiglzaKtr5C2KCOT0HJvpnMzY&callback=initMap&libraries=&v=weekly'
    asyn defer></script>

  <script>
  
  /*variables*/
 
  


  let hotel=document.querySelector('#Hotel');
  let hostal=document.querySelector('#Hostal');
  let albergue=document.querySelector('#Albergue');
  let casaRural=document.querySelector('#CasaRural');
  let todos=document.querySelector('#all');
 
  let hoteles=document.querySelector("#infoHoteles");
  let info=hoteles.dataset.hotels;
  var array=JSON.parse(info);


 var cambio=new Array();
  


hotel.addEventListener('click',function(){
filtrar(array,hotel.id);

});
hostal.addEventListener('click',function(){
  filtrar(array,hostal.id);
  
  
})
albergue.addEventListener('click',function(){
  filtrar(array,albergue.id);
  
})
casaRural.addEventListener('click',function(){
filtrar(array,casaRural.id);

})

todos.addEventListener('click',function(){
sessionStorage.removeItem('Regionactividad'); 
mostrarAlojamientos(array);
mostrarTodos();

})


document.addEventListener("DOMContentLoaded",function(){


if(window.sessionStorage){
  if(!sessionStorage.getItem('Regionactividad')){

mostrarAlojamientos(array)
  }else{
let actividad=sessionStorage.getItem("Regionactividad");
  console.log(actividad)
  filtrar(array,actividad);
 
  }
}
  
});

function filtrar(array,actividad){
 
sessionStorage.setItem('Regionactividad',actividad)
cambio=array.filter((element) => {
 return( element.actividad.nombre == actividad )});
if(cambio!=undefined && cambio.length >0){
mostrarAlojamientos(cambio);
filterMarkers(actividad);
}else{
mostrarMensaje();
}

}


function mostrarMensaje(){

  let div=document.getElementById('alojamiento');
  let hijo=document.getElementById('hijo');
  div.removeChild(hijo);


  let divhijo=document.createElement('div');
  divhijo.id="hijo";

let parrafo=document.createElement('p');
parrafo.textContent="No hay alojamientos disponibles"
divhijo.appendChild(parrafo);
div.appendChild(divhijo);
}


const iconos={

  icon1:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
  <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
</svg>`
}


function mostrarAlojamientos(array){



let result=document.getElementById('result');
result.contentText=array.length;
  let div=document.getElementById('alojamiento');
  let hijo=document.getElementById('hijo');
  div.removeChild(hijo);


  let divhijo=document.createElement('div');
  divhijo.id="hijo";
  divhijo.classList="row p-2";
  

  for(let i=0;i<array.length;i++){

let principal=document.createElement('div');
principal.classList="col-sm-6 mb-3";

let item=document.createElement('div');
item.classList="packege__item";
let inner=document.createElement('div');
inner.classList="packege__inner";


let thumb=document.createElement('div');
thumb.classList="packege__thumb";
let enlace=document.createElement('a');
enlace.href="/alojamiento/" + array[i]['Nombre'];
let imagen=document.createElement('img');
imagen.setAttribute('src','/img/alojamientos/'+ array[i]['images'][0]['imageName']);
enlace.appendChild(imagen)
thumb.appendChild(enlace);

let content=document.createElement('div');
content.classList="packege__content";
let aContent=document.createElement('a');
aContent.href="/alojamiento/" + array[i]['Nombre'];
let h5=document.createElement('h5');
h5.textContent=array[i]['Nombre'];
let rivew=document.createElement('div');
rivew.classList="packege__rivew";
let left=document.createElement('div')
left.classList="left";
let p1=document.createElement('p');
p1.classList="gx-2 m-0";
let span1=document.createElement('span')
span1.textContent=array[i]['ubicacion']['provincia'];
p1.innerHTML=iconos.icon1 +span1.textContent

let span2=document.createElement('span');
span2.textContent= array[i]['caracteristicas'] ;

let right=document.createElement('div');
right.classList="right";
let span3=document.createElement('span');
span3.textContent=array[i]['precio'] + '€ por noche';
left.appendChild(p1);
left.appendChild(span2)
right.appendChild(span3);
rivew.appendChild(left);
rivew.appendChild(right);
aContent.appendChild(h5);
content.appendChild(aContent)
content.appendChild(rivew)




inner.appendChild(thumb);
inner.appendChild(content)
item.appendChild(inner);
principal.appendChild(item);
 

    divhijo.appendChild(principal)
  }

div.appendChild(divhijo);
  }
  





var map,i;
var infowindow=[];
var markers=[];
var gmarkers=[];


function initMap() {
  let lat=parseFloat(array[0]['ubicacion']['region'].latitud);
  let lng=parseFloat(array[0]['ubicacion']['region'].longitud); 



  const region = {
    lat: lat,
    lng: lng
  };
  map = new google.maps.Map(document.getElementById("map2"), {
    zoom: 8,
    center: region,
   
  });




  
  let image = {
    url: '/img/signo.png', //ruta de la imagen
    size: new google.maps.Size(60, 60), //tamaño de la imagen
    origin: new google.maps.Point(0,0), //origen de la iamgen
  //el ancla de la imagen, el punto donde esta marcando, en nuestro caso el centro inferior.
  anchor: new google.maps.Point(0, 0) 
   };

   for (i = 0; i < array.length; i++) {

      markers[i] = new google.maps.Marker({
      position: new google.maps.LatLng(array[i]['ubicacion'].latitud, array[i]['ubicacion'].longitud),
      map:map,
      actividad:array[i]['actividad']['nombre'],
      icon: image
    });

gmarkers.push(markers[i])
    infowindow[i] = new google.maps.InfoWindow({
      content:'<a href="/alojamiento/' +  array[i]['Nombre'] + '"><img src="/img/alojamientos/'+ array[i]['images'][1]['imageName'] + '"  style=" margin:0px;" width="250px"><div style="w-100"><div class="p-3" style="width:250px"><h5 class="fw-light">' + array[i]['Nombre']+'</h5><p>'+ array[i]['caracteristicas']+'</p><span class="">'+array[i]['precio']+ '€' +'</span></div></div></a>' });
  google.maps.event.addListener(markers[i], 'click', function(valor) { 
    return function(){ 
    infowindow[valor].open(map,markers[valor]); 
  }
  }(i));
  
}


  };

 function filterMarkers(actividad){
   console.log(gmarkers)
  for(let i=0;i<gmarkers.length;i++){
    marker=gmarkers[i];
       if(marker.actividad==actividad || actividad.length ===0){
           marker.setVisible();
      }else{
           marker.setVisible(false);
      }
  }
}

 function mostrarTodos(){

  for(let i=0;i<gmarkers.length;i++){

gmarkers[i].setVisible();
  }
}



function moveLocation(lat,lng){
const center=new google.maps.LatLng(lat,lng);
window.map.panto(center);

}


/*
function getGET()
    {
        // capturamos la url
        var loc = document.location.href;
        // si existe el interrogante
        if(loc.indexOf('?')>0)
        {
            // cogemos la parte de la url que hay despues del interrogante
            var getString = loc.split('?')[1];
            // obtenemos un array con cada clave=valor
            var GET = getString.split('&');
            var get = {};
            // recorremos todo el array de valores
            for(var i = 0, l = GET.length; i < l; i++){
                var tmp = GET[i].split('=');
                get[tmp[0]] = unescape(decodeURI(tmp[1]));
            }
            return get;
        }
    }
*/
 
    /*
        // Cogemos los valores pasados por get
        var valores=getGET();
        if(valores)
        {
            //recogemos los valores que nos envia la URL en variables para trabajar 
                //con ellas
            var actividad= valores['actividad'];
            console.log(min);
            var min=valores['minPrecio'];
            var max=valores['maxPrecio'];

            minPrecio.value=min;
            maxPrecio.value=max;
           

            filtrar(array,actividad);
             
        }else{
            // no se ha recibido ningun parametro por GET
            document.write("No se ha recibido ningún parámetro");
        }
  
*/


  </script>
{% endblock %}

  